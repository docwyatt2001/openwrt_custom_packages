--- a/getarch.c
+++ b/getarch.c
@@ -134,6 +134,7 @@ USE OF THIS SOFTWARE, EVEN IF ADVISED OF
 /* #define FORCE_I6400		*/
 /* #define FORCE_P6600		*/
 /* #define FORCE_P5600		*/
+/* #define FORCE_1004K		*/
 /* #define FORCE_I6500		*/
 /* #define FORCE_ITANIUM2	*/
 /* #define FORCE_SPARC		*/
@@ -766,6 +767,20 @@ USE OF THIS SOFTWARE, EVEN IF ADVISED OF
 #else
 #endif
 
+#ifdef FORCE_1004K
+#define FORCE
+#define ARCHITECTURE    "MIPS"
+#define SUBARCHITECTURE "1004K"
+#define SUBDIRNAME      "mips"
+#define ARCHCONFIG   "-DMIPS1004K " \
+       "-DL1_DATA_SIZE=65536 -DL1_DATA_LINESIZE=32 " \
+       "-DL2_SIZE=1048576 -DL2_LINESIZE=32 " \
+       "-DDTB_DEFAULT_ENTRIES=64 -DDTB_SIZE=4096 -DL2_ASSOCIATIVE=8 "
+#define LIBNAME   "1004K"
+#define CORENAME  "1004K"
+#else
+#endif
+
 #ifdef FORCE_I6500
 #define FORCE
 #define ARCHITECTURE    "MIPS"
--- a/common_mips.h
+++ b/common_mips.h
@@ -46,7 +46,8 @@ static inline unsigned int rpcc(void){
   unsigned long ret;
 
   __asm__ __volatile__(".set   push    \n"
-          "rdhwr %0, $30  \n"
+          ".set mips32r2\n"
+          "rdhwr %0, $2 \n"
           ".set pop" : "=r"(ret) : : "memory");
 
   return ret;
